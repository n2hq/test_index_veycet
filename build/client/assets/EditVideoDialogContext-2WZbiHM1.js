import{j as t}from"./jsx-runtime-0DLF9kdB.js";import{r as e}from"./components-DPfHZ1Ve.js";import{u as de}from"./NotificationContext-BGyxjMcq.js";import{_ as ue,w as me,v as fe,$ as ve,N as pe}from"./lib-B83UiCcG.js";import{u as ne}from"./OperationContext-DEJBADlp.js";import{o as he,s as A}from"./types-DBTFAyTi.js";const ae=e.createContext(null);function Ee(){return e.useContext(ae)}const xe=/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).{8,}$/;he({videolink:A({message:"Please enter the video link"}),url:A().url("Video link is not valid."),videotitle:A({message:"Please enter a password"}).min(8,"Password must be at least 8 characters").regex(xe,"Please enter a valid password"),videodescription:A().trim().max(500,"Description must be less than 500 characters.").optional()});function je({children:g}){const[se,s]=e.useState(!1),[w,N]=e.useState(!1),[v,D]=e.useState(null),[P,F]=e.useState(null),[_,z]=e.useState(null),[K,R]=e.useState(!1),[W,M]=e.useState(null),p=de(),[h,B]=e.useState(null),[le,L]=e.useState(null),[G,U]=e.useState(!1),[J,T]=e.useState(!1),[y,Z]=e.useState(void 0),[Y,C]=e.useState(""),{showOperation:E,showError:j,completeOperation:V,showSuccess:q}=ne();e.useEffect(()=>{w&&(U(!1),T(!1),Z(void 0),C(""))},[w]),e.useEffect(()=>{Y&&Y.trim().length>0?(U(!1),T(!0)):(U(!1),T(!1))},[Y]);const H=()=>{N(!1),D(null)};e.useEffect(()=>{const o=document.getElementById("videolink");Z(o)},[]),e.useEffect(()=>{(y==null?void 0:y.value.trim().length)>0&&T(!0)},[y]);const O=()=>{E("processing","Verifying video link.");const o=document.getElementById("videolink");X(o.value)};async function Q(o){const m=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${o}&format=json`;try{const l=await fetch(m);if(!l.ok)throw new Error("Video not found");const f=await l.json();return!0}catch{return console.error("❌ Invalid or unavailable video"),!1}}const X=async o=>{E("processing"),await new Promise(d=>setTimeout(d,1e3));const m=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,l=o.match(m);let f=l?l[1]:null,k=`https://img.youtube.com/vi/${f}/0.jpg`,n={videoId:f,videoUrl:o,videoThumbnail:k};if(await Q(f))try{B(n),U(!0);const d=document.getElementById("yt-iframe");d.src=`https://www.youtube.com/embed/${n==null?void 0:n.videoId}`}finally{V(),q("Verified","Enter the video title and optional description to continue.")}else p.alertCancel("Video error!","Video could not be loaded!");await new Promise(d=>setTimeout(d,1e3)),B(n)};e.useEffect(()=>{const o=document.getElementById("yt-iframe");o!=null&&o.onload&&console.log("✅ Iframe page loaded"),L(o)},[]);const ee=o=>{C(o)},$=async()=>{s(!0),E("processing","Submitting video link"),await new Promise(oe=>setTimeout(oe,1e3));let o=document.getElementById("videolink"),m=document.getElementById("videotitle"),l=document.getElementById("videodescr"),f=o.value,k=m.value,n=l.value;if(f.trim().length<=0)return j("Error","Please enter a Youtube video link"),V(),s(!1),!1;if(k.trim().length<=0)return j("Error","Please enter a video title"),V(),s(!1),!1;if(n.trim().length>500)return p.alertCancel("Submission error!","Video description should not be more than 500 characters!"),s(!1),!1;const d=await ue({video_url:f,video_title:k,video_description:n,user_guid:P,business_guid:_,video_guid:""});if(d!=null&&d.data.videoInsertId)try{q("Success","Video link submitted"),V()}finally{window.location.reload()}else p==null||p.alertCancel("Submission Error","Video Link submission failed."),j("Error","Submission failed."),V()};let u={dialog:w,setDialog:N,imgSrc:v,setImgSrc:D,handleCloseDialog:H,userGuid:P,setUserGuid:F,businessGuid:_,setBusinessGuid:z,isImgSelected:K,setIsImageSelected:R,selectedFile:W,setSelectedFile:M};return t.jsxs(ae.Provider,{value:u,children:[w&&t.jsx("div",{className:`flex w-screen h-screen z-[3000] 
                fixed top-0 left-0 right-0 bottom-0 bg-black/30 rounded-[8px]
                place-content-center place-items-center overflow-hidden`,children:t.jsx("div",{className:`relative w-[90%] h-[80%] bg-white 
                        rounded-[8px] overflow-x-hidden overflow-y-hidden z-[3000]`,onClick:o=>{o.preventDefault()},children:t.jsxs("div",{className:"relative h-full overflow-y-auto",children:[t.jsx("div",{className:"relative w-full h-[75%] max-h-[75%] bg-black",children:t.jsxs("div",{className:" relative w-full h-full text-white flex place-items-center place-content-center flex-col",children:[se?"Loading...":"Paste a Youtube link below!",t.jsx("iframe",{id:"yt-iframe",src:h!=null&&h.videoId?`https://www.youtube.com/embed/${h==null?void 0:h.videoId}`:void 0,className:"absolute top-0 left-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})]})}),t.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[t.jsx("div",{className:"text-[14px] font-semibold py-1",children:"Paste a Youtube video link"}),t.jsx("input",{id:"videolink",type:"text",placeholder:"Paste a Youtube Video",className:"w-full border-[1px] border-gray-700 bg-gray-100 px-3 py-4 outline-none rounded-lg",onKeyUp:o=>{ee(o.target.value)}})]}),t.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[t.jsx("div",{className:"text-[14px] font-semibold py-1",children:"Enter video title"}),t.jsx("input",{id:"videotitle",type:"text",placeholder:"Enter Video Title",className:"w-full border-[1px] border-gray-700 bg-gray-100 px-3 py-4 outline-none rounded-lg"})]}),t.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[t.jsx("div",{className:"text-[14px] font-semibold py-1",children:"Enter title description"}),t.jsx("textarea",{id:"videodescr",placeholder:"Enter picture description.",className:"w-full border-[1px] border-gray-700 bg-gray-100 px-3 py-4 outline-none rounded-lg"})]}),t.jsxs("div",{className:"flex place-content-end px-3 gap-2",children:[t.jsx("button",{onMouseDown:()=>H(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Cancel"}),t.jsx("button",{onClick:()=>$(),className:`bg-blue-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4 ${G?"block":"hidden"}`,children:"Submit"}),t.jsx("button",{onClick:()=>O(),disabled:!J,className:`${J?"bg-blue-800":"bg-blue-300"} ${G&&"hidden"} text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Verify"})]})]})})}),g]})}const re=e.createContext(null);function ke(){const g=e.useContext(re);if(!g)throw new Error("Wrap the app with an EditVideoDialogProvider!");return g}function Ie({children:g}){const[se,s]=e.useState(!1),[w,N]=e.useState(!1),[v,D]=e.useState(null),[P,F]=e.useState(null),[_,z]=e.useState(null),[K,R]=e.useState(!1),[W,M]=e.useState(null),[p,h]=e.useState(null),[B,le]=e.useState(null),[L,G]=e.useState(null),[U,J]=e.useState(null),[T,y]=e.useState(null),[Z,Y]=e.useState(null),[C,E]=e.useState(!1),[j,V]=e.useState(!0),[q,H]=e.useState(void 0),[O,Q]=e.useState(""),[X,ee]=e.useState(null);e.useRef(null),de();const{showOperation:$,showError:u,completeOperation:o,showSuccess:m}=ne();e.useEffect(()=>{O.trim().length>0&&(E(!1),V(!0))},[O]),e.useEffect(()=>{if(v){const i=me(v);ee(i)}},[v]);const l=()=>{N(!1),D(null),s(!1)},f=async()=>{s(!0),$("processing"),await new Promise(ie=>setTimeout(ie,1e3));let i=document.getElementById("videolink"),S=document.getElementById("videotitle"),a=document.getElementById("videodescr"),x=i.value,I=S.value,r=a.value;if(x.trim().length<=0)return u("Error","Please enter a video link to proceed."),o(),s(!1),!1;if(I.trim().length<=0)return u("Error","Please enter a title for the video."),o(),s(!1),!1;if(r.trim().length>500)return u("Error","Video description should not be more than 500 characters."),o(),s(!1),!1;const c=await ve({video_url:x,video_title:I,video_description:r,user_guid:P,business_guid:_,video_guid:L});(c==null?void 0:c.data.success)===!0?(m("Success","Video link is updated."),o()):(u("Error","Update failed"),o())},k=async(i,S,a)=>{const I=pe.BASE_URL+"/api/listing/save_video_link",r={user_guid:i,business_guid:S,video_guid:a,video_url:"",video_description:"",video_title:""};s(!0),$("processing","Submitting video"),await new Promise(b=>setTimeout(b,1e3));try{const b=await fetch(I,{method:"DELETE",headers:fe,body:JSON.stringify(r)});if(b.ok)m("Success","Video deleted."),o();else{let c=b.json().then(ie=>{u("Error",`Failed: ${ie.message}`),o()})}}catch(b){console.log(b),u("Error","Update failed")}finally{s(!1)}},n=i=>{Q(i)};async function te(i){const S=`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${i}&format=json`;try{const a=await fetch(S);if(!a.ok)throw new Error("Video not found");const x=await a.json();return!0}catch{return console.error("❌ Invalid or unavailable video"),!1}}const d=async i=>{$("processing","Verifying video"),await new Promise(c=>setTimeout(c,1e3));const S=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/,a=i.match(S);let x=a?a[1]:null,I=`https://img.youtube.com/vi/${x}/0.jpg`,r={videoId:x,videoUrl:i,videoThumbnail:I};if(await te(x))try{y(r),E(!0);const c=document.getElementById("yt-iframe");c.src=`https://www.youtube.com/embed/${r==null?void 0:r.videoId}`}finally{m("Success","Video link is verified"),o()}else u("Error","Video could not be loaded!"),o();await new Promise(c=>setTimeout(c,1e3)),y(r)},oe=()=>{const i=document.getElementById("videolink");d(i.value)};let ce={dialog:w,setDialog:N,handleCloseDialog:l,videoSrc:v,setVideoSrc:D,userGuid:P,setUserGuid:F,businessGuid:_,setBusinessGuid:z,isImgSelected:K,setIsImageSelected:R,selectedFile:W,setSelectedFile:M,videoTitle:p,setVideoTitle:h,videoGuid:L,setVideoGuid:G,setVideoDescription:le,deleteVideo:k};return t.jsxs(re.Provider,{value:ce,children:[w&&t.jsx("div",{className:`flex w-screen h-screen z-[3000] 
                fixed top-0 left-0 right-0 bottom-0 bg-black/30 rounded-[8px]
                place-content-center place-items-center overflow-hidden`,children:t.jsx("div",{className:`relative w-[90%] h-[80%] bg-white 
                        rounded-[8px] overflow-x-hidden overflow-y-hidden z-[3000]`,onClick:i=>{i.preventDefault()},children:t.jsxs("div",{className:"relative h-full overflow-y-auto",children:[t.jsx("div",{className:"relative w-full h-[75%] max-h-[75%] bg-black",children:t.jsx("div",{className:" relative w-full h-full",children:t.jsx("iframe",{id:"yt-iframe",src:v?`https://www.youtube.com/embed/${X}`:void 0,className:"absolute top-0 left-0 w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})})}),t.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[t.jsx("div",{className:"text-[14px] font-semibold py-1",children:"Paste a Youtube video link"}),t.jsx("input",{id:"videolink",type:"text",defaultValue:v,placeholder:"Enter Video Link",className:"w-full border-[1px] border-gray-700 bg-gray-100 px-3 py-4 outline-none rounded-lg",onKeyUp:i=>{n(i.target.value)}})]}),t.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[t.jsx("div",{className:"text-[14px] font-semibold py-1",children:"Enter video title"}),t.jsx("input",{id:"videotitle",defaultValue:p,type:"text",placeholder:"Enter Video Title",className:"w-full border-[1px] border-gray-700 bg-gray-100 px-3 py-4 outline-none rounded-lg"})]}),t.jsxs("div",{className:"flex mb-1 flex-col mx-3 ",children:[t.jsx("div",{className:"text-[14px] font-semibold py-1",children:"Enter title description"}),t.jsx("textarea",{id:"videodescr",defaultValue:B,placeholder:"Enter video description.",className:"w-full border-[1px] border-gray-700 bg-gray-100 px-3 py-4 outline-none rounded-lg"})]}),t.jsxs("div",{className:"flex place-content-end px-3 gap-2",children:[t.jsx("button",{onMouseDown:()=>window.location.reload(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Reload"}),t.jsx("button",{onMouseDown:()=>l(),className:`bg-gray-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Close"}),t.jsx("button",{onClick:()=>f(),className:`bg-blue-800 text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4 ${C?"block":"hidden"}`,children:"Submit"}),t.jsx("button",{onClick:()=>oe(),disabled:!j,className:`${j?"bg-blue-800":"bg-blue-300"} ${C&&"hidden"} text-white px-3 py-1.5 rounded-md
                                    shadow-md mb-2 mt-4`,children:"Verify"})]})]})})}),g]})}export{je as A,Ie as E,Ee as a,ke as u};
