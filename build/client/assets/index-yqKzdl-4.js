import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,u as ie,e as le}from"./components-DPfHZ1Ve.js";import{u as ce}from"./AuthContext-DKUMkAUy.js";import{N as $,Z as ue,J as me,K as oe,L as re,v as de,O as pe,q as ge,a3 as fe,P as he,Q as be,E as xe,av as we,aw as Pe}from"./lib-B83UiCcG.js";import{P as ye}from"./ProfileLayout-CdzgTbzA.js";import{u as Se,a as je}from"./zod-CC5ug8f6.js";import{o as _e,s as f,a as h,u as Ie,l as Ne,Z as Ee}from"./types-DBTFAyTi.js";import{p as ve,T as se}from"./TextareaWithWordLimit-BEPeujo1.js";import{u as H}from"./NotificationContext-BGyxjMcq.js";import{u as K,O as Ce}from"./OperationContext-DEJBADlp.js";import{B as Te}from"./Button-7Woa2p3a.js";import{I as x}from"./Input-DSaqWb7d.js";import{f as Be,c as te}from"./css-CVxtJxAn.js";import{S as W}from"./Select-CIZ5QM-8.js";import{B as Ae}from"./BusinessMenu-eJb8kUdc.js";import{B as De}from"./BusinessDrawer-Bp9_ABtu.js";import{L as Oe}from"./LoadingMessage-CO2lhh43.js";import"./AccountUserImage-DUVY_Zmu.js";import"./HomeNav-Bd3MTT6k.js";import"./MainNav-C35PW04j.js";import"./index-BVQZtB2M.js";const Ue=_e({username:h(),pagetype:f({message:"Please select page type"}).min(1,{message:"Please select page type"}),email_address:f({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:f().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:f({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:f({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:f().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),long_description:f().nullish().refine(e=>!e||e.trim()===""?!0:e.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:h(),state_code:h(),state_text:h(),country_text:h(),city_id:h(),established:f().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Year established must contain only numbers"}).refine(e=>e===""||e.length<=4,{message:"Year established must not be more than 4 digits"}),zipcode:f().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Zipcode must contain only numbers"}).refine(e=>e===""||e.length<=7,{message:"Zipcode must not be more than 7 digits"}),call_code:h(),phone:f().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),intro:h(),category:f().min(2,{message:"Please select a business category"}),business_phrases:Ie([Ne(""),f({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:h(),services:h(),xsocial:h(),fbsocial:h(),linksocial:h(),website:f().nullable().optional().refine(e=>{if(!e||e==="")return!0;try{return new URL(e),!0}catch{return!1}},{message:"Please enter a valid website. Example: http://example.com"})}).superRefine((e,d)=>{var l,p;((l=e==null?void 0:e.address_two)==null?void 0:l.length)!==0&&((p=e==null?void 0:e.address_two)==null?void 0:p.length)<3&&d.addIssue({code:Ee.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),Me=({listing:e,user:d,businessProfileBgData:l})=>{let p="";l!=null&&l.image_url&&(p=$.IMG_BASE_URL+l.image_url);const[w,M]=t.useState(p),[C,B]=t.useState(null),P=t.useRef(null),[A,_]=t.useState(!1),[y,b]=t.useState(!1);H();const{showOperation:k,showSuccess:j,showError:S,showWarning:D,showInfo:z,completeOperation:m}=K(),O=()=>{var o;(o=P.current)==null||o.click()},I=o=>{var u;const c=(u=o.target.files)==null?void 0:u[0];if(c){const i=URL.createObjectURL(c);M(i),B(c),_(!0)}},U=async()=>{b(!0),k("processing"),await new Promise(c=>setTimeout(c,1e3));const o=new FormData;if(A){o.append("file",C),o.append("guid",d.user_guid),o.append("bid",e.gid);const u=$.IMG_BASE_URL+"/business_profile_bg_upload";try{const i=await fetch(u,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:o});if(i.ok)j("Success","Image uploaded."),m();else{let L=i.json().then(N=>{S("Error",N.message),m()})}}catch(i){console.log(i.message),S("Error","Image upload failed."),m()}finally{b(!1)}}else S("Error","Please select an image to continue."),m(),b(!1)};return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"relative bg-gray-700 w-full h-[200px] z-[0] shadow-lg text-white flex place-items-center place-content-center flex-col",children:[w===""&&"Add Photo (1920x200)",w&&s.jsx("img",{src:w,alt:"",className:"object-cover w-full h-full  absolute z-[40]"}),s.jsx("input",{type:"file",accept:"image/*",ref:P,className:" hidden",onChange:I})]}),s.jsxs("div",{className:` flex place-items-center gap-1.5
                place-content-center top-[5px] right-[5px] w-fit z-[120] absolute`,children:[s.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:y,onMouseDown:O,children:"Browse"}),s.jsx("button",{className:` bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:U,disabled:y,children:y?"Uploading...":"Upload"})]})]})},ke=({listing:e,user:d,businessProfileImageData:l})=>{let p="";l.image_url&&(p=$.IMG_BASE_URL+l.image_url);const[w,M]=t.useState(p),[C,B]=t.useState(null),P=t.useRef(null),[A,_]=t.useState(!1),[y,b]=t.useState(!1);H();const{showOperation:k,showSuccess:j,showError:S,showWarning:D,showInfo:z,completeOperation:m}=K(),O=()=>{var o;(o=P.current)==null||o.click()},I=o=>{var u;const c=(u=o.target.files)==null?void 0:u[0];if(c){const i=URL.createObjectURL(c);M(i),B(c),_(!0)}},U=async()=>{b(!0),k("processing"),await new Promise(c=>setTimeout(c,1e3));const o=new FormData;if(A){o.append("file",C),o.append("guid",d.user_guid),o.append("bid",e.gid);const u=$.IMG_BASE_URL+"/business_profile_pic_upload";try{const i=await fetch(u,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:o});if(i.ok)j("Success","Image uploaded."),m();else{let L=i.json().then(N=>{S("Error",N.message),m()})}}catch{S("Error","Image upload failed"),m()}finally{b(!1)}}else S("Error","Please select an image to continue."),m(),b(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden border-[2px] border-gray-200",children:[s.jsx("img",{src:w,alt:"",className:`object-cover w-full h-full z-0 absolute ${w===""?"bg-black":"bg-white"}`}),s.jsx("input",{type:"file",accept:"image/*",ref:P,className:" hidden",onChange:I}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:O,children:s.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(ue,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:s.jsx("button",{className:`${y?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:U,disabled:y,children:y?"Uploading...":"Upload"})})]})},Le=({data:e})=>{var X,ee;const[d,l]=t.useState(null),[p,w]=t.useState(!1);H();const[M,C]=t.useState(null),[B,P]=t.useState(!1),{showOperation:A,showSuccess:_,showError:y,showWarning:b,showInfo:k,completeOperation:j}=K(),S=e.countries;let[D,z]=t.useState(e.states),[m,O]=t.useState(e.cities);const I=(X=me)==null?void 0:X.sort((g,v)=>g.name.localeCompare(v.name)),[U,o]=t.useState(e.businessProfile.country_code),[c,u]=t.useState(e.businessProfile.state_code),[i,L]=t.useState(""),[N,R]=t.useState(""),F=async g=>{o(g),L(g);const v=await oe(g);z(v),J("")},J=async g=>{u(g),R(g);const v=await re(U,g);O(v)},n=g=>{let v=g.target.value,q=g.target.name;l(T=>({...T,[q]:v}))},Z=async g=>{w(!0),A("processing","Updating page profile"),await new Promise(T=>setTimeout(T,1e3));const v="/api/listing/"+e.businessProfile.gid,q=$.BASE_URL+v;try{const T=await fetch(q,{method:"PUT",headers:de,body:JSON.stringify(g)});if(T.ok)_("Success","Page profile updated."),j();else{const ne=await T.text(),ae=JSON.parse(ne);throw new Error(`${ae.error}`)}}catch(T){y("error",`${T.message}`),j()}finally{w(!1)}},{register:r,handleSubmit:V,getValues:G,setValue:E,watch:Y,setError:Q,formState:{errors:a,isSubmitting:Re}}=Se({defaultValues:e.businessProfile,resolver:je(Ue)});return t.useEffect(()=>{e.businessProfile&&(E("state_code",e.businessProfile.state_code),E("city_id",e.businessProfile.city_id))},[e.businessProfile]),t.useEffect(()=>{i&&(E("state_code",""),E("city_id",""))},[i,e]),t.useEffect(()=>{N&&E("city_id","")},[N]),s.jsxs("div",{children:[s.jsx(De,{isOpen:B,businessGuid:e.businessProfile.gid,userGuid:(ee=e.businessProfile)==null?void 0:ee.owner}),s.jsx(Me,{listing:e.businessProfile,user:e.userProfile,businessProfileBgData:e.businessProfileBgData}),s.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:s.jsx("div",{className:"absolute top-[-50px]",children:s.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:s.jsx(ke,{listing:e.businessProfile,user:e.userProfile,businessProfileImageData:e.businessProfileImageData})})})}),s.jsxs("div",{children:[s.jsx("hr",{className:"mb-4"}),s.jsxs("div",{className:"relative w-full flex place-items-center gap-1 place-content-end px-[10px]",children:[s.jsx("a",{href:"/web/account/portfolio",className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Portfolio"}),s.jsx("a",{href:`/${e.businessProfile.gid}`,className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Preview"}),(e==null?void 0:e.businessProfile)&&s.jsx(Ae,{setIsOpen:P,guid:e==null?void 0:e.businessProfile.gid,userGuid:e==null?void 0:e.businessProfile.owner})]}),s.jsx("form",{className:"w-full px-[10px]",onSubmit:V(Z),children:s.jsxs("div",{className:`${Be} mt-0  rounded-lg pt-4 md:max-w-[80%]
                                lg:max-w-[60%] w-full mx-auto `,children:[s.jsx("div",{className:"text-2xl mb-5",children:"Page update"}),s.jsx("div",{className:"text-xl font-[600] leading-[1.4em] px-[10px] text-black mb-[32px]",children:e==null?void 0:e.businessProfile.title}),s.jsx(x,{controlTitle:"Page Username",controlPlaceholder:"Enter username",controlName:"username",register:r,changeHandler:n,error:a.username,controlInformation:"Choose a username. "}),s.jsx(W,{controlTitle:"Page Type",controlName:"pagetype",controlPlaceholder:"Select Page Type",selectJson:ve,register:r,changeHandler:n,error:a.pagetype,controlInformation:"Select business category."}),s.jsx(x,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:r,changeHandler:n,error:a.email_address,controlInformation:"Email address is compulsory."}),s.jsx(x,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:r,changeHandler:n,error:a.title,controlInformation:"Please enter page name. Page name is compulsory. "}),s.jsx(W,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:I,register:r,changeHandler:n,error:a.category,controlInformation:"Select business category."}),s.jsx(x,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:r,changeHandler:n,error:a.established,controlInformation:"This is the name the business was registered or started "}),s.jsx(x,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:r,changeHandler:n,error:a.address_one,width:100,controlInformation:"Contact address for the business. "}),s.jsx(x,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:r,changeHandler:n,error:a.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),s.jsx(W,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:S,register:r,changeHandler:n,error:a.country_code,setCode:F,controlInformation:"Country the business was registered. "}),s.jsx(W,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:D,register:r,changeHandler:n,error:a.state_code,setCode:J,controlInformation:"State the business was registered. "}),s.jsx(W,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:m,register:r,changeHandler:n,error:a.city_id,controlInformation:"City the business was registered. "}),s.jsx(x,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:r,changeHandler:n,error:a.zipcode,controlInformation:"Enter the zipcode. E.g.: 51234 or 845219 "}),s.jsx(x,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:r,changeHandler:n,error:a.phone,controlInformation:"Mobile number or phone number. "}),s.jsx(x,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:r,changeHandler:n,error:a.business_phrases,controlInformation:"Enter business phrases like: Solicitor, Advocate, Plumber, Business Analyst, Mechanical Engineers."}),s.jsx(x,{controlTitle:"Products",controlPlaceholder:"E.g.: Publications, Accessories, Shoes, Subscriptions, Magazines, Cars",controlName:"products",register:r,changeHandler:n,error:a.products,controlInformation:"Enter your products name like: Magazines, Generators, Accessories, Perfumes, Publications etc."}),s.jsx(x,{controlTitle:"Services",controlPlaceholder:"E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc.",controlName:"services",register:r,changeHandler:n,error:a.services,controlInformation:"Enter your services E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc."}),s.jsx(se,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:r,changeHandler:n,error:a.short_description,setValue:E,getValues:G,watch:Y,controlInformationClass:te,controlInformation:"Short description of business activities"}),s.jsx(se,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:r,changeHandler:n,error:a.long_description,setValue:E,getValues:G,watch:Y,controlInformationClass:te,controlInformation:"More description about the business."}),s.jsx(x,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:r,changeHandler:n,error:a.website,controlInformation:"Your website should look like this: http://example.com "}),s.jsx(Te,{working:p})]})})]})]})},is=()=>{var L;t.useEffect(()=>{pe(localStorage)},[]);const e=ie(),d=ce();if(!d)return null;const l=e.business_guid,p=(L=d==null?void 0:d.user)==null?void 0:L.guid,[w,M]=t.useState(!0),[C,B]=t.useState(null),[P,A]=t.useState(null),[_,y]=t.useState(null),[b,k]=t.useState(null),[j,S]=t.useState(null),[D,z]=t.useState(null),[m,O]=t.useState(null),[I,U]=t.useState(null),[o,c]=t.useState(null),[u,i]=t.useState(null);return le(),t.useEffect(()=>{async function N(R,F){const J=await ge(R||""),n=await fe(F||""),Z=await he(),r=n,V=await oe(r.country_code||""),G=await re(r.country_code||"",r.state_code||""),E=await be(),Y=await xe(R||""),Q=await we(F||""),a=await Pe(F||"");B(J),A(n),k(Z),y(V),S(G),z(Y),O(Q),c(E),U(a)}try{p&&l&&N(p,l)}catch(R){console.log(R.message)}},[p,l]),t.useEffect(()=>{C&&P&&b&&_&&j&&D&&o&&m&&I&&i({userProfile:C,businessProfile:P,countries:b,states:_,cities:j,userProfileImageData:D,businessProfileImageData:m,businessProfileBgData:I,categories:o})},[o,b,_,j,D,m,C,P,I]),t.useEffect(()=>{u&&M(!1)},[u]),w?s.jsx(s.Fragment,{children:s.jsx(Oe,{})}):s.jsx(ye,{children:s.jsx(Ce,{children:u!==null&&s.jsx(Le,{data:u})})})};export{is as default};
