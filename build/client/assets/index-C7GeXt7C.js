import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,c as E}from"./components-DPfHZ1Ve.js";import{O as C,l as O,a3 as U}from"./lib-B83UiCcG.js";import{A as P}from"./AccountLayout-D_sH2dba.js";import{C as R}from"./ContentLayout-DGf8_Bh-.js";import{u as k}from"./AuthContext-DKUMkAUy.js";import{u as I}from"./OperationContext-DEJBADlp.js";import{L as T}from"./LoadingMessage-CO2lhh43.js";import"./AccountUserImage-DUVY_Zmu.js";import"./HomeNav-Bd3MTT6k.js";import"./MainNav-C35PW04j.js";import"./index-BVQZtB2M.js";import"./BusinessMenu-eJb8kUdc.js";import"./BusinessDrawer-Bp9_ABtu.js";function $({userGuid:x}){const[y,g]=t.useState(""),[f,r]=t.useState([]),[o,u]=t.useState(null),[S,l]=t.useState(""),[c,n]=t.useState([]),[d,j]=t.useState(null),{showOperation:b,showError:i,completeOperation:m,showSuccess:w}=I(),N=async e=>{if(g(e),e.length<2)return r([]);const h=await(await fetch(`/api/listing/business_single_search?q=${encodeURIComponent(e)}&user_guid=${x}`)).json();r(h)},_=async e=>{if(l(e),e.length<2)return n([]);const h=await(await fetch(`/api/listing/user_single_search?q=${encodeURIComponent(e)}`)).json();n(h)},B=async()=>{if(b("processing"),!d||!o){i("Error","Please select both a user and a business before submitting."),m();return}await new Promise(a=>setTimeout(a,1e3));const e=JSON.parse(JSON.stringify(d)),p=JSON.parse(JSON.stringify(o)),h={user_guid:e.user_guid,previous_owner_guid:p.owner,business_guid:p.gid};console.log(e),console.log(p),console.log(h);try{const a=await fetch("/api/listing/reassign_business",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!a.ok){const v=await a.text();console.error("Error response:",v),i("Error",`${v}`),m();return}const A=await a.json();w("Success","Business reassigned successfully!"),m()}catch(a){console.error("Request failed:",a),i("Error","Something went wrong while reassigning."),m()}};return s.jsxs("div",{className:"space-y-6 p-4 max-w-lg",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search Business"}),s.jsx("input",{id:"biz",type:"text",value:y,onChange:e=>N(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"Type business name..."}),f.length>0&&s.jsx("ul",{className:"border mt-2 rounded bg-white shadow divide-y",children:f.map((e,p)=>s.jsx("li",{onClick:()=>{u(e),r([]),g(e.title)},className:"p-2 cursor-pointer hover:bg-gray-100",children:e.title},e.id))}),o&&s.jsx("input",{type:"hidden",name:"businessId",value:o.id})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search User"}),s.jsx("input",{id:"user",type:"text",value:S,onChange:e=>_(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"Type user name..."}),c.length>0&&s.jsx("ul",{className:"border mt-2 rounded bg-white shadow divide-y",children:c.map(e=>s.jsxs("li",{onClick:()=>{j(e),n([]),l(`${e.first_name}, ${e.lastname}`)},className:"p-2 cursor-pointer hover:bg-gray-100",children:[e.first_name,", ",e.lastname]},e.id))}),d&&s.jsx("input",{type:"hidden",name:"userId",value:d.id})]}),s.jsx("button",{type:"submit",onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Submit"})]})}const Z=()=>{t.useEffect(()=>{C(localStorage)},[]);const[x,y]=t.useState(!0),[g,f]=t.useState(null),[r,o]=t.useState(""),[u,S]=t.useState(""),{business_guid:l,user_guid:c}=E(),[n,d]=t.useState(null);return k()?(t.useEffect(()=>{const b=async(i,m)=>{o(i),S(m);const w=await U(i||"");d(w)};try{l&&c&&b(l,c)}catch(i){O(i)}},[l,c]),t.useEffect(()=>{r&&u&&n&&(f({businessGuid:r,userGuid:u,businessProfile:n}),y(!1))},[r,u,n]),x?s.jsx(T,{}):s.jsx(P,{children:s.jsx(R,{title:"Delete Business Profile",businessGuid:r,data:g,businessProfile:n,children:g&&s.jsx($,{userGuid:u})})})):null};export{Z as default};
